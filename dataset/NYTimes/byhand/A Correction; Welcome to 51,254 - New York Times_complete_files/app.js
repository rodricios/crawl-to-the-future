(function(){var Emphasis={init:function(){this.config();this.pl=false;this.p=false;this.h=false;this.s=false;this.vu=false;this.kh="|";this.addCSS();this.readHash();Event.observe(window,"keydown",this.keydown);},config:function(){this.paraSelctors=$$(".articleBody p:not(p[class]):not(:empty)","#articleBody p:not(p[class]):not(:empty)","#content div.entry-content p:not(p[class]):not(:empty)");this.classReady="emReady";this.classActive="emActive";this.classHighlight="emHighlight";this.classInfo="emInfo";this.classAnchor="emAnchor";this.classActiveAnchor="emActiveAnchor";},addCSS:function(){var styleNode=document.createElement("style");var headNode=document.getElementsByTagName("head")[0];headNode.appendChild(styleNode);var styleSheetNode=styleNode.sheet?styleNode.sheet:styleNode.styleSheet;var pClassActiveSelector="p."+this.classActive+" span";var pSpanClassHighlistSelector="p span."+this.classHighlight;var spanClassInfoASelector="span."+this.classInfo+" a";var aClassActiveAnchorSelector="a."+this.classActiveAnchor;var spanClassInfoSelector="span."+this.classInfo;var pClassActiveSpanCss="background-color: #f2f4f5;";var pSpanClassHighlistCss="background-color: #fff0b3;";var spanClassInfoACss="text-decoration: none;";var aClassActiveAnchorCss="color: #000; font-size: 11px;";var spanClassInfoCss="position:absolute; margin:-1px 0px 0px -8px; padding:0; font-size:10px; "+"background-color: transparent !important;";if(styleSheetNode&&styleSheetNode.addRule){styleSheetNode.addRule(pClassActiveSelector,pClassActiveSpanCss);styleSheetNode.addRule(pSpanClassHighlistSelector,pSpanClassHighlistCss);styleSheetNode.addRule(spanClassInfoASelector,spanClassInfoACss);styleSheetNode.addRule(aClassActiveAnchorSelector,aClassActiveAnchorCss);styleSheetNode.addRule(spanClassInfoSelector,spanClassInfoCss);}else{if(styleSheetNode&&styleSheetNode.insertRule){var rules=styleSheetNode.cssRules?styleSheetNode.cssRules:styleSheetNode.rules;styleSheetNode.insertRule(pClassActiveSelector+" {"+pClassActiveSpanCss+"}",rules.length);styleSheetNode.insertRule(pSpanClassHighlistSelector+" {"+pSpanClassHighlistCss+"}",rules.length);styleSheetNode.insertRule(spanClassInfoASelector+" {"+spanClassInfoACss+"}",rules.length);styleSheetNode.insertRule(aClassActiveAnchorSelector+" {"+aClassActiveAnchorCss+"}",rules.length);styleSheetNode.insertRule(spanClassInfoSelector+" {"+spanClassInfoCss+"}",rules.length);}}},readHash:function(){var lh=decodeURI(location.hash);var p=false,h=[],s={};if(lh.indexOf("[")<0&&lh.indexOf("]")<0){var a,re=/[ph][0-9]+|s[0-9,]+|[0-9]/g;if(lh){while((a=re.exec(lh))!==null){var f=a[0].substring(0,1);var r=a[0].substring(1);if(f=="p"){p=parseInt(r);}else{if(f=="h"){h.push(parseInt(r));}else{a=r.split(",");for(var i=0;i<a.length;i++){a[i]=parseInt(a[i]);}s[h[h.length-1]]=a;}}}}}else{var findp=lh.match(/p\[([^[\]]*)\]/);var findh=lh.match(/h\[([^[\]]*)\]/);var undef,hi;p=(findp&&findp.length>0)?findp[1]:false;hi=(findh&&findh.length>0)?findh[1]:false;if(hi){hi=hi.match(/[a-zA-Z]+(,[0-9]+)*/g);for(var i=0;i<hi.length;i++){var a=hi[i].split(",");var key=a[0];var pos=this.findKey(key)["index"];if(pos!=undef){h.push(parseInt(pos)+1);var b=a;b.shift();if(b.length>0){for(var j=1;j<b.length;j++){b[j]=parseInt(b[j]);}}s[h[h.length-1]]=b;}}}}this.p=p;this.h=h;this.s=s;this.goAnchor(p);this.goHighlight(h,s);},keydown:function(e){var self=Emphasis;var kc=e.keyCode;self.kh=self.kh+kc+"|";if(self.kh.indexOf("|16|16|")>-1){self.vu=(self.vu)?false:true;self.paragraphInfo(self.vu);}setTimeout(function(){self.kh="|";},500);},paragraphList:function(){if(this.pl){return this.pl;}var instance=this;var list=[];var keys=[];var c=0;var len=this.paraSelctors.length;for(var p=0;p<len;p++){var pr=this.paraSelctors[p];if((pr.innerText||pr.textContent||"").length>0){var k=instance.createKey(pr);list.push(pr);keys.push(k);pr.setAttribute("data-key",k);pr.setAttribute("data-num",c);Event.observe(pr,"click",function(e){instance.paragraphClick(e);});c++;}}this.pl={list:list,keys:keys};return this.pl;},paragraphClick:function(e){if(!this.vu){return;}var hasChanged=false;var pr=(e.currentTarget.nodeName=="P")?e.currentTarget:false;var sp=(e.target.nodeName=="SPAN")?e.target:false;var an=(e.target.nodeName=="A")?e.target:false;if(an){if(!an.hasClassName(this.classActiveAnchor)){this.updateAnchor(an);hasChanged=true;e.preventDefault();}}if(!pr&&!sp){this.removeAllClasses("p",this.classActive);return;}if(pr.hasClassName(this.classReady)){if(!pr.hasClassName(this.classActive)&&(sp&&!sp.hasClassName(this.classHighlight))){this.removeAllClasses("p",this.classActive);pr.addClassName(this.classActive);}else{if(!pr.hasClassName(this.classActive)){this.removeAllClasses("p",this.classActive);pr.addClassName(this.classActive);}if(sp){sp.toggleClassName(this.classHighlight);hasChanged=true;}}}else{var lines=this.getSentences(pr);var jLen=lines.length;for(var j=0;j<jLen;j++){lines[j]="<span data-num='"+(j+1)+"'>"+this.rtrim(lines[j])+"</span>";}var txt=lines.join(". ").replace(/__DOT__/g,".").replace(/<\/span>\./g,".</span>");var chr=txt.substring(txt.length-8).charCodeAt(0);if("|8221|63|46|41|39|37|34|33|".indexOf(chr)==-1){txt+=".";}pr.innerHTML=txt;pr.setAttribute("data-sentences",jLen);this.removeAllClasses("p",this.classActive);pr.addClassName(this.classActive);pr.addClassName(this.classReady);hasChanged=true;}if(hasChanged){this.updateURLHash();}},paragraphInfo:function(mode){if(mode){var hasSpan=(document.body.select("span."+this.classInfo)[0])?true:false;if(!hasSpan){var pl=this.paragraphList();var len=pl.list.length;for(var i=0;i<len;i++){var para=pl.list[i]||false;if(para){var key=pl.keys[i];var isActive=(key==this.p)?(" "+this.classActiveAnchor):"";para.innerHTML="<span class='"+this.classInfo+"'><a class='"+this.classAnchor+isActive+"' href='#p["+key+"]' data-key='"+key+"' title='Link to "+this.ordinal(i+1)+" paragraph'>&para;</a></span>"+para.innerHTML;}}}}else{var spans=document.body.select("span."+this.classInfo);var len=spans.length;for(var i=0;i<len;i++){spans[i].remove();}this.removeAllClasses(this.classActive);}},updateAnchor:function(an){this.p=an.getAttribute("data-key");this.removeAllClasses("a",this.classActiveAnchor);an.addClassName(this.classActiveAnchor);},updateURLHash:function(){var h="h[";var paras=$$("p.emReady");var pLen=paras.length;for(var p=0;p<pLen;p++){var key=paras[p].getAttribute("data-key");if(paras[p].hasClassName(this.classHighlight)){h+=","+key;}else{var spans=paras[p].select("span."+this.classHighlight);var sLen=spans.length;var nSent=paras[p].getAttribute("data-sentences");if(sLen>0){h+=","+key;}if(nSent!=sLen){for(var s=0;s<sLen;s++){h+=","+spans[s].getAttribute("data-num");}}}}var anchor=((this.p)?"p["+this.p+"],":"");var hash=(anchor+(h.replace("h[,","h[")+"]")).replace(",h[]","");location.hash=hash;},createKey:function(p){var key="";var len=6;var txt=(p.innerText||p.textContent||"").replace(/[^a-z\. ]+/gi,"");if(txt&&txt.length>1){var lines=this.getSentences(txt);if(lines.length>0){var first=this.cleanArray(lines[0].replace(/[\s\s]+/gi," ").split(" ")).slice(0,(len/2));var last=this.cleanArray(lines[lines.length-1].replace(/[\s\s]+/gi," ").split(" ")).slice(0,(len/2));var k=first.concat(last);var max=(k.length>len)?len:k.length;for(var i=0;i<max;i++){key+=k[i].substring(0,1);}}}return key;},findKey:function(key){var pl=this.paragraphList();var ln=pl.keys.length;var ix=false;var el=false;for(var i=0;i<ln;i++){if(key==pl.keys[i]){return{index:i,elm:pl.list[i]};}else{if(!ix){var ls=this.lev(key.slice(0,3),pl.keys[i].slice(0,3));var le=this.lev(key.slice(-3),pl.keys[i].slice(-3));if((ls+le)<3){ix=i;el=pl.list[i];}}}}return{index:ix,elm:el};},goAnchor:function(p){if(!p){return;}var pg=(isNaN(p))?this.findKey(p)["elm"]:(this.paragraphList().list[p-1]||false);var instance=this;if(pg){setTimeout(function(){pg.scrollTo();},500);}},goHighlight:function(h,s){if(!h){return;}var hLen=h.length;for(var i=0;i<hLen;i++){var para=this.paragraphList().list[h[i]-1]||false;if(para){var sntns=s[h[i].toString()]||false;var multi=!sntns||sntns.length==0;var lines=this.getSentences(para);var jLen=lines.length;for(var j=0;j<jLen;j++){var k=(multi)?j:sntns[j]-1;lines[j]="<span data-num='"+(j+1)+"'>"+lines[j]+"</span>";}for(var j=0;j<jLen;j++){var k=(multi)?j:sntns[j]-1;var line=lines[k]||false;if(line){lines[k]=lines[k].replace("<span","<span class='"+this.classHighlight+"'");}}para.setAttribute("data-sentences",jLen);para.innerHTML=lines.join(". ").replace(/__DOT__/g,".").replace(/<\/span>\./g,".</span>");para.addClassName("emReady");}}},getSentences:function(el){var html=(typeof el=="string")?el:el.innerHTML;var mrsList="Mr,Ms,Mrs,Miss,Msr,Dr,Gov,Pres,Sen,Prof,Gen,Rep,St,Messrs,Col,Sr,Jf,Ph,Sgt,Mgr,Fr,Rev,No,Jr,Snr";var topList="A,B,C,D,E,F,G,H,I,J,K,L,M,m,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,etc,oz,cf,viz,sc,ca,Ave,St";var geoList="Calif,Mass,Penn,AK,AL,AR,AS,AZ,CA,CO,CT,DC,DE,FL,FM,GA,GU,HI,IA,ID,IL,IN,KS,KY,LA,MA,MD,ME,MH,MI,MN,MO,MP,MS,MT,NC,ND,NE,NH,NJ,NM,NV,NY,OH,OK,OR,PA,PR,PW,RI,SC,SD,TN,TX,UT,VA,VI,VT,WA,WI,WV,WY,AE,AA,AP,NYC,GB,IRL,IE,UK,GB,FR";var numList="0,1,2,3,4,5,6,7,8,9";var webList="aero,asia,biz,cat,com,coop,edu,gov,info,int,jobs,mil,mobi,museum,name,net,org,pro,tel,travel,xxx";var extList="www";var d="__DOT__";var list=(topList+","+geoList+","+numList+","+extList).split(",");var len=list.length;for(var i=0;i<len;i++){html=html.replace(new RegExp((" "+list[i]+"\\."),"g"),(" "+list[i]+d));}list=(mrsList+","+numList).split(",");len=list.length;for(var i=0;i<len;i++){html=html.replace(new RegExp((list[i]+"\\."),"g"),(list[i]+d));}list=(webList).split(",");len=list.length;for(var i=0;i<len;i++){html=html.replace(new RegExp(("\\."+list[i]),"g"),(d+list[i]));}var lines=this.cleanArray(html.split(". "));return lines;},ordinal:function(n){var sfx=["th","st","nd","rd"],val=n%100;return n+(sfx[(val-20)%10]||sfx[val]||sfx[0]);},lev:function(a,b){var m=a.length;var n=b.length;var r=[];r[0]=[];if(m<n){var c=a;a=b;b=c;var o=m;m=n;n=o;}for(var c=0;c<n+1;c++){r[0][c]=c;}for(var i=1;i<m+1;i++){r[i]=[];r[i][0]=i;for(var j=1;j<n+1;j++){r[i][j]=this.smallest(r[i-1][j]+1,r[i][j-1]+1,r[i-1][j-1]+((a.charAt(i-1)==b.charAt(j-1))?0:1));}}return r[m][n];},smallest:function(x,y,z){if(x<y&&x<z){return x;}if(y<x&&y<z){return y;}return z;},rtrim:function(txt){return txt.replace(/\s+$/,"");},cleanArray:function(a){var n=[];for(var i=0;i<a.length;i++){if(a[i]&&a[i].replace(/ /g,"").length>0){n.push(a[i]);}}return n;},removeAllClasses:function(tag,klass){if(!klass||!tag){return;}var els=$$((tag+"."+klass));for(var i=0;i<els.length;i++){els[i].removeClassName(klass);}}};Event.observe(window,"load",function(){Emphasis.init();});})();